const API = "https://api.bigmotor.biz.id";

document.getElementById("btnLogin").addEventListener("click", doLogin);

async function doLogin() {
  const u = document.getElementById("username").value.trim();
  const p = document.getElementById("password").value.trim();

  const username = u + "@bigmotor.biz.id"; // aturan baru

  console.log("LOGIN TRY:", username);

  if (!u || !p) {
    showError("Masukkan username & password");
    return;
  }

  try {
    const res = await fetch(API + "/login", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ username, password: p }),
    });

    const json = await res.json();
    console.log("LOGIN RESPONSE:", json);

    if (!json.ok) {
      showError("Login gagal: " + (json.error || "Unknown"));
      return;
    }

    // simpan user session
    localStorage.setItem("bmt_user", JSON.stringify(json.user));

    showError(""); // clear
    alert("Login berhasil");
    window.location.href = "beranda.html";

  } catch (e) {
    console.log("LOGIN ERROR:", e);
    showError("Kesalahan jaringan");
  }
}

function showError(msg) {
  document.getElementById("loginError").innerText = msg;
}
